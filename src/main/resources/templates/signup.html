<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>
</head>
<body>
<h1>회원가입</h1>
<form id="signupForm" action="/user/signup" method="post" onsubmit="return signup()">
    <div>
        <label for="email">이메일:</label>
        <input type="email" id="email" name="email" required>
        <span id="emailMessage"></span>
    </div>
    <div>
        <label for="password">비밀번호:</label>
        <input type="password" id="password" name="password" required>
    </div>
    <div>
        <label for="profile">프로필 사진 파일 이름:</label>
        <input type="text" id="profile" name="profile">
    </div>
    <div>
        <label for="address">집 주소:</label>
        <input type="text" id="address" name="address">
    </div>
    <div>
        <label for="phone">휴대전화 번호:</label>
        <input type="tel" id="phone" name="phone">
    </div>
    <div>
        <label for="username">사용자 이름:</label>
        <input type="text" id="username" name="username">
    </div>
    <div>
        <label for="nickname">닉네임:</label>
        <input type="text" id="nickname" name="nickname">
    </div>
    <div>
        <label>성별:</label>
        <input type="radio" id="male" name="gender" value="MALE">
        <label for="male">남성</label>
        <input type="radio" id="female" name="gender" value="FEMALE">
        <label for="female">여성</label>
        <input type="radio" id="other" name="gender" value="OTHER">
        <label for="other">기타</label>
    </div>
    <button type="submit">가입하기</button>
</form>

<script>
    async function signup() {
        event.preventDefault(); // 폼 제출 방지

        const emailInput = document.getElementById("email");
        const emailMessage = document.getElementById("emailMessage");
        const email = emailInput.value.trim(); // 입력된 이메일 가져오기 (앞뒤 공백 제거)

        try {
            const response = await fetch("/user/signup/check/" + email); // 서버로 요청 보내고 응답 받기
            if (response.ok) {
                const data = await response.text(); // 응답 데이터 가져오기
                if (data === "사용 가능한 이메일입니다.") {
                    emailMessage.textContent = ""; // 메시지 초기화
                    document.getElementById("signupForm").submit(); // 폼 제출
                } else {
                    emailMessage.textContent = data; // 중복된 이메일인 경우 메시지 표시
                }
            } else {
                emailMessage.textContent = "네트워크 오류가 발생했습니다."; // 네트워크 오류 처리
            }
        } catch (error) {
            emailMessage.textContent = "서버 요청 중 오류가 발생했습니다."; // 오류 처리
            console.error(error); // 에러 로깅
        }
    }
</script>
</body>
</html>